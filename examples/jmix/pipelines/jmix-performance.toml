# ------------------------
# High-Performance JMIX endpoint configuration
# This example shows how to configure default skip flags in the config file
#-------------------------
[pipelines.jmix_performance]
description = "High-performance JMIX API with default skip flags for large datasets"
networks = ["http_net"]
endpoints = ["jmix_api_performance"]
middleware = [
    "jmix_builder",
]
backends = ["dicom_pacs"]

# ------------------------
# Middleware
#-------------------------
[middleware.jmix_builder]
type = "jmix_builder"
[middleware.jmix_builder.options]
# Performance optimization flags configured on the middleware
skip_hashing = true   # Skip SHA256 hashing by default for faster processing
skip_listing = false  # Still include file listings by default for inventory

# ------------------------
# JMIX HTTP endpoint
# Routes:
#   GET  /jmix/api/jmix?studyInstanceUid=...     -> triggers DICOM backend if not cached
#   GET  /jmix/api/jmix/{id}                     -> download stored envelope (zip/gzip via Accept)
#   GET  /jmix/api/jmix/{id}/manifest            -> fetch stored manifest.json
#
# Note: Performance options (skip_hashing, skip_listing) are configured on the
# jmix_builder middleware above, not on the endpoint.
#-------------------------
[endpoints.jmix_api_performance]
service = "jmix"
[endpoints.jmix_api_performance.options]
path_prefix = "/jmix"
# Performance optimization flags
skip_hashing = true   # Skip SHA256 hashing for faster processing
skip_listing = true   # Skip DICOM files from files.json manifest

# Optional: custom storage directory
# store_dir = "./tmp/jmix-store-performance"

# ------------------------
# DICOM backend (remote PACS)
#-------------------------
[backends.dicom_pacs]
service = "dicom"
[backends.dicom_pacs.options]
aet = "ORTHANC"              # Remote AE (Orthanc)
host = "127.0.0.1"
port = 4242
local_aet = "HARMONY_SCU"    # Our AE title
# DICOM retrieval mode: "get" (default) or "move"
# - "get" (C-GET): Works without PACS-side AE configuration, images received directly
# - "move" (C-MOVE): Requires PACS to know SCU's AE title and network address
dimse_retrieve_mode = "get"
incoming_store_port = 11112  # Port Orthanc will push C-STORE to
persistent_store_scp = true  # keep a persistent C-STORE SCP listening